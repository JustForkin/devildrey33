$Base=new function(){this.Entrada=[];this.Estado_Log=0;this.Ticks_Log=0;this.JSDinamico=[];this.CSSDinamico=[];this.PosPrevNext=-2;this.PosPrevNext_Tipo=0;this.PeticionAjax=0;this.Ancla;this.TemporizadorAncla=0;this.FuncionCargarCSS=function(){};this.FuncionCargarJS=function(){};this.FPL=function(){};this.Timeout=0;this.Raiz="";this.RaizRelativa="";this.URL="";this.nURL="";this.CustomSearchControl=0;this.Iniciar=function(){$(".Lab_BotonVerFilas").click(function(e){$Lab.AjustarVista("0");});$(".Lab_BotonVerColumnas").click(function(e){$Lab.AjustarVista("1");});$(".Lab_BotonVerCodigo").click(function(e){$Lab.AjustarVista("2");});$(".Lab_BotonVerPreview").click(function(e){$Lab.AjustarVista("3");});$Lab.EnlazarEventosExplorador();$("#BarraPrincipal_Boton_Estado").click(function(e){$Base.ClickMenu(0);});$("#BarraPrincipal_BotonCSS_Estado").click(function(e){$Base.ClickMenu(1);});$("#BarraPrincipal_BotonCPP_Estado").click(function(e){$Base.ClickMenu(2);});$("#BarraPrincipal_BotonJS_Estado").click(function(e){$Base.ClickMenu(3);});$("#BarraPrincipal_BotonPHP_Estado").click(function(e){$Base.ClickMenu(4);});$("#BarraPrincipal_BotonBuscar_Estado").click(function(e){$Base.ClickMenu(5);});$("#BarraNavegacion_BotonVer_Estado").click(function(e){$Base.ClickMenu(6);});$("#BarraNavegacion_BotonExplorar_Estado").click(function(e){$Base.ClickMenu(7);});$("#BarraNavegacion_Indice_Estado").click(function(e){$Base.ClickMenu(9);});$("#BarraNavegacion_PrevNext_Estado").click(function(e){$Base.ClickMenu(10);});$("#BarraNavegacion_RedesSociales_Estado").click(function(e){$Base.ClickMenu(11);});$("#BarraNavegacion_Votacion_Estado").click(function(e){$Base.ClickMenu(12);});$("#BarraPrincipal_MarcoBuscar_BotonBuscar").click(function(e){$Base.Buscar();});$("#BarraPrincipal_MarcoBuscar_Edit").keyup(function(e){if(event.which===13){$Base.Buscar();}});$("#BarraNavegacion_MarcoNextPrev_Prev").click(function(e){$Base.BotonVerSiguiente();});$("#BarraNavegacion_MarcoNextPrev_Desc").click(function(e){$Base.CargarURL($("#BarraNavegacion_MarcoNextPrev_Desc").attr("Path"));});$("#BarraNavegacion_MarcoNextPrev_Next").click(function(e){$Base.BotonVerAnterior();});$("#BarraNavegacion_MarcoRedesSociales_Facebook").click(function(e){$Base.BotonFacebook();});$("#BarraNavegacion_MarcoRedesSociales_Twitter").click(function(e){$Base.BotonTwitter();});$("#BarraNavegacion_MarcoRedesSociales_GooglePlus").click(function(e){$Base.BotonGooglePlus();});this.Entrada=this.IdentificarEntrada(document.location.pathname,document.location.pathname);window.history.replaceState(this.Entrada,this.Entrada["Titulo"],document.location.pathname);$('#BarraNavegacion > a').click(function(e){e.preventDefault();e.stopImmediatePropagation();$Base.CargarURL($(this).attr("href"));return false;});$('#BarraPrincipal > #BarraPrincipal_Submenus a').click(function(e){console.log("Base.(#BarraPrincipal > #BarraPrincipal_Submenus a).Click");e.preventDefault();e.stopImmediatePropagation();$Base.ClickMenu(0);$Base.CargarURL($(this).attr("href"));return false;});$("#Logo > div:nth-child(5)").dblclick(function(e){if($Base.Estado_Log===0){$Base.Ticks_Log=$Base.GetTickCount();$Base.Estado_Log=1;setTimeout(function(){$Base.Estado_Log=0;},1500);}});$("#Logo > div:nth-child(11)").dblclick(function(e){if($Base.Estado_Log===1){console.log("Tiempo de los clicks : "+parseInt($Base.GetTickCount()-$Base.Ticks_Log)+" milisegundos.");$Base.MostrarLogin();}});$("#devildrey33_Usuario").keyup(function(e){switch(e.keyCode){case 27:$("#VentanaLogin").attr({"Visible":"false"});break;case 13:$("#devildrey33_Password").focus();break;}});$("#devildrey33_Password").keyup(function(e){switch(e.keyCode){case 27:$("#VentanaLogin").attr({"Visible":"false"});break;case 13:$Base.Loguear();break;}});$("#ErroresPHP_Cerrar").click(function(e){$("#ErroresPHP").attr({"mostrar":false});});this.RedireccionarLinks();if(typeof localStorage["Comentarios_Usuario"]!=='undefined'){$("#devildrey33_Usuario").val(localStorage["Comentarios_Usuario"]);}};this.MostrarLogin=function(FuncionPostLogin){if(typeof(FuncionPostLogin)!=="undefined")this.FPL=FuncionPostLogin;$("#VentanaLogin").attr({"Visible":"true"});setTimeout(function(){if(typeof localStorage["Comentarios_Usuario"]==='undefined'){$("#devildrey33_Usuario").focus();}
else{$("#devildrey33_Password").focus();}},200);};this.MostrarErroresPHP=function(){console.log("Base.MostrarErroresPHP");$EFP=$("#ErroresFinPlantilla").html();if($EFP!==""){$("#ErroresPHP_Info").html($EFP);}
$("#ErroresPHP").attr({"mostrar":true});};this.BotonTwitter=function(){Texto=$(".Cabecera > .Cabecera_Datos > h1").html();console.log("Base.BotonTwitter",Texto,window.location.href);window.open("http://twitter.com/home?status="+Texto+": "+window.location.href,"Twitter","toolbar=no,width=550,height=255");};this.BotonFacebook=function(){Texto=$(".Cabecera > .Cabecera_Datos > h1").html();console.log("Base.BotonFacebook",Texto,window.location.href);window.open("http://www.facebook.com/share.php?u="+window.location.href+"&t="+Texto,"Facebook","toolbar=no,width=550,height=355");};this.BotonGooglePlus=function(){Texto=$(".Cabecera > .Cabecera_Datos > h1").html();console.log("Base.BotonGooglePlus",Texto,window.location.href);window.open("https://plus.google.com/share?url="+window.location.href+"&t="+Texto,"Google Plus","toolbar=no,width=550,height=355");};this.BotonLinkEdin=function(){Texto=$(".Cabecera > .Cabecera_Datos > h1").html();console.log("Base.BotonLinkEdin",Texto,window.location.href);}
this.Debug=(function(){var Consola=console;return function(Valor,Limpiar){var nLimpiar=Limpiar||false;if(Valor===false){console={};console.log=function(){};if(nLimpiar){console.info=function(){};console.warn=function(){};console.error=function(){};}else{console.info=Consola.info;console.warn=Consola.warn;console.error=Consola.error;}}
else{console=Consola;}};})();this.ClickMenu=function(Menu){console.log("Base.ClickMenu",Menu);if(Menu!==1){$("#BarraPrincipal_BotonCSS_Estado").removeAttr("checked");}
if(Menu!==2){$("#BarraPrincipal_BotonCPP_Estado").removeAttr("checked");}
if(Menu!==3){$("#BarraPrincipal_BotonJS_Estado").removeAttr("checked");}
if(Menu!==4){$("#BarraPrincipal_BotonPHP_Estado").removeAttr("checked");}
if(Menu!==5){$("#BarraPrincipal_BotonBuscar_Estado").removeAttr("checked");}
if(Menu===5){$("#BarraPrincipal_MarcoBuscar_Edit").focus().select();}
if(Menu!==6){$("#BarraNavegacion_BotonVer_Estado").removeAttr("checked");}
if(Menu!==7){$("#BarraNavegacion_BotonExplorar_Estado").removeAttr("checked");}
if(Menu!==8){$("#BarraPrincipal_Boton33_Estado").removeAttr("checked");}
if(Menu!==9){$("#BarraNavegacion_Indice_Estado").removeAttr("checked");}
if(Menu===8){$("#BarraPrincipal_Boton_Estado").removeAttr("checked");}
if(Menu!==10){$("#BarraNavegacion_PrevNext_Estado").removeAttr("checked");}
if(Menu!==11){$("#BarraNavegacion_RedesSociales_Estado").removeAttr("checked");}
if(Menu!==12){$("#BarraNavegacion_Votacion_Estado").removeAttr("checked");}};this.GetTickCount=function(){var d=new Date();return d.getTime();};this.RedireccionarLinks=function(){console.log("Base.RedireccionarLinks");$("#MarcoNavegacion a[href]:not([target])").off("click").on("click",function(e){e.preventDefault();e.stopImmediatePropagation();$Base.CargarURL($(this).attr("href"));return false;});Pagina=$("#MarcoNavegacion > article").attr("pagina");$("#BarraNavegacion_Votacion").removeAttr("Mostrar");this.ComprobarScrollVotacion();$PintarCodigo.EnlazarEtiquetas();this.ActualizarBarraNavegacion();$Lab.MiniLab_Iniciar();this.LogoCargando("FALSE");};this.VotarWeb=function(Valor){Pagina=$("#MarcoNavegacion > article").attr("pagina");$("#BarraNavegacion_Votacion_Estado").removeAttr("checked");console.log("Base.VotarWeb",Valor,Pagina);if(typeof localStorage["Voto_"+Pagina]==="undefined"){localStorage["Voto_"+Pagina]=Valor;$.post(this.Raiz+"cmd/VotarPagina.cmd",{"Pagina":Pagina,"Valor":Valor,"URL":window.location.href}).done(function(data){Datos=JSON.parse(data);if(Datos["HTML"]!=="false"){$(".Cabecera_Datos > .FechaEntrada > span").html(Datos["HTML"]);$("#BarraNavegacion_Votacion").removeAttr("Mostrar");if($("html").attr("lang")==="es"){$Base.MostrarMensaje("La votación se ha relaizado correctamente, muchas gracias!");}
else{$Base.MostrarMensaje("Your vote is annotated, thank you!");}}
$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}}).fail(function(jqXHR,textStatus,tError){console.log("Base.VotarWeb Error ajax",jqXHR,textStatus,tError);$Base.MostrarErrorAjax(jqXHR.status,false,tError);});}
else{if($("html").attr("lang")==="es"){$Base.MostrarMensaje("Solo puedes votar una vez por página.");}
else{$Base.MostrarMensaje("Only you can vote one time per page.");}}};this.MostrarMensaje=function(Mensaje,Titulo,Alerta,Funcion){console.log("Base.MostrarMensaje("+Mensaje+")");if(typeof(Alerta)==="undefined"){Alerta="false";}
else{if(typeof(Titulo)==="undefined"){Titulo="Mensaje de alerta";}}
if(typeof(Titulo)==="undefined"){Titulo="Mensaje";}
if(typeof(Funcion)==="undefined"){Funcion=function(){};}
Ventana=$("<div class='VentanaMensaje MarcoVentana-350' visible='false' alerta='"+Alerta+"' titulo='"+Titulo+"'>"+"<p>"+Mensaje+"</p>"+"<div class='Centrado'>"+"<button class='BotonVentana'>Aceptar</button>"+"</div>"+"</div>");Ventana.find(".Centrado > button").on("click",{"Funcion":Funcion},function(event){$(this).parent().parent().attr({"visible":"false"});event.data.Funcion();setTimeout(function(Ventana){Ventana.remove();},500,$(this).parent().parent());});Ventana.appendTo('body').attr({"visible":"false"});setTimeout(function(Ventana){Ventana.attr({"visible":"true"}).find("button").focus();},100,Ventana);};this.MostrarErrorAjax=function(Error,VolverIndice,Excepcion){console.log("Base.MostrarErrorAjax("+Error+", "+VolverIndice+")");this.LogoCargando("FALSE");this.Cargando("FALSE");switch(Error){case 403:Mensaje="Error 403 en la petición ajax.<br />No se permite el acceso al archivo solicitado.";break;case 404:Mensaje="Error 404 en la petición ajax.<br />El archivo solicitado no existe.";break;case 1404:Mensaje="Error 404 en la petición ajax.<br />No se puede cargar el ejemplo del lab.";break;default:Mensaje="Error 500 en la petición ajax.<br />Es posible que el servidor no esté disponible en estos momentos. ("+Excepcion+")";break;}
Funcion=function(){};if(VolverIndice===true){this.Entrada["TipoPagina"]="Error404";Mensaje=Mensaje+" Pulsa aceptar para ser re-dirigido al indice.";Funcion=function(){$Base.CargarURL("/");};}
this.MostrarMensaje(Mensaje,"true",Funcion);};this.IdentificarEntrada=function(URL,URLReal){var Ret={"Titulo":"devildrey33","URL":URL,"URLReal":URLReal,"Imagen":"","TipoPagina":"Desconocido","Pos":-2,"Idioma":"es"};if(URLReal.indexOf("Categorias/")>-1||URL==="/"+this.RaizRelativa||URL===this.Raiz){Ret["TipoPagina"]="Indice";$("body").attr({"Tipo":Ret["TipoPagina"]});console.log("Base.IdentificarEntrada : "+Ret["TipoPagina"],Ret);return Ret;}
nURL="";cURL=URL.toLowerCase();if(cURL.indexOf("blog/")>-1){Ret["TipoPagina"]="Blog";nURL=URL.substr(6);}
if(cURL.indexOf("doc/css")>-1){Ret["TipoPagina"]="DocCSS";nURL=URL.substr(8);}
if(cURL.indexOf("lab/")>-1){Ret["TipoPagina"]="Lab";nURL="";}
if(cURL.indexOf("web/")>-1||cURL.indexOf("faqbarba")>-1){Ret["TipoPagina"]="Web";nURL="";}
$("body").attr({"Tipo":Ret["TipoPagina"]});console.log("Base.IdentificarEntrada : "+Ret["TipoPagina"],Ret);return Ret;};this.BuscarEntradaActual=function(nURL,nTitulo){for(i=0;i<EntradasBlog.length;i++){if(nURL.indexOf(EntradasBlog[i]["URL"])!==-1&&EntradasBlog[i]["Titulo"]===nTitulo){console.log("Base.BuscarEntradaActual : "+i,EntradasBlog[i]);this.Entrada["Titulo"]=EntradasBlog[i]["Titulo"];this.Entrada["Imagen"]=EntradasBlog[i]["Imagen"];this.Entrada["Idioma"]=EntradasBlog[i]["Idioma"];this.PosPrevNext_Tipo=EntradasBlog[i]["Tipo"];return i;}}
console.log("Base.BuscarEntradaActual : -1");return-1;};this.ActualizarBarraNavegacion=function(){console.log("Base.ActualizarBarraNavegacion",this.Entrada);this.EscanearAnclas();switch(this.Entrada["TipoPagina"]){case"LabError":case"Error404":case"Error404SinPlantilla":this.MostrarBarraNavegacion();break;case"Lab":$Lab.Iniciar();this.MostrarBarraNavegacion();break;case"Indice":$("#MarcoIndice").attr({"visible":true});$("#Categorias").attr({"visible":true});$Indice.Iniciar();this.OcultarBarraNavegacion();break;case"Blog":case"DocCSS":$Comentarios.Iniciar();this.MostrarBarraNavegacion();break;case"Web":this.MostrarBarraNavegacion();break;case"Buscar":$("#BarraNavegacion_Prev").hide();$("#BarraNavegacion_Next").hide();break;default:this.OcultarBarraNavegacion();break;}};this.CrearPrevNext=function(Pos){console.log("Base.CrearPrevNext",Pos);if(Pos>EntradasBlog.length||Pos<0)return false;$("#BarraNavegacion_MarcoNextPrev_Next").removeAttr("disabled");$("#BarraNavegacion_MarcoNextPrev_Prev").removeAttr("disabled");this.PosPrevNext=Pos;if(this.Entradas_BuscarSiguienteMismoTipo(Pos)===-1){$("#BarraNavegacion_MarcoNextPrev_Next").attr({"disabled":"disabled"});}
if(this.Entradas_BuscarAnteriorMismoTipo(Pos)===-1){$("#BarraNavegacion_MarcoNextPrev_Prev").attr({"disabled":"disabled"});}
Imagen="CSS3.png";if(EntradasBlog[this.PosPrevNext]["Tipo"].indexOf("DocCSS")===-1){Imagen=EntradasBlog[this.PosPrevNext]["Imagen"];}
$("#BarraNavegacion_MarcoNextPrev_Desc").html("<img src='"+this.Raiz+"Web/Graficos/155x125_"+Imagen+"' alt=''/>"+"<h3>"+EntradasBlog[this.PosPrevNext]["Titulo"]+"</h3>");$("#BarraNavegacion_MarcoNextPrev_Desc").attr({"Path":EntradasBlog[this.PosPrevNext]["URL"]});return true;};this.BotonVerSiguiente=function(){if(this.CrearPrevNext(this.Entradas_BuscarAnteriorMismoTipo(this.PosPrevNext))===false){$("#BarraNavegacion_MarcoNextPrev_Next").attr({"disabled":"disabled"});}};this.BotonVerAnterior=function(){if(this.CrearPrevNext(this.Entradas_BuscarSiguienteMismoTipo(this.PosPrevNext))===false){$("#BarraNavegacion_MarcoNextPrev_Next").attr({"disabled":"disabled"});}};this.Entradas_BuscarSiguienteMismoTipo=function(Cont){while(--Cont>-1){if(this.PosPrevNext_Tipo===EntradasBlog[Cont]["Tipo"]){if(Cont!==this.Entrada["Pos"]){return Cont;}}}
return-1;}
this.Entradas_BuscarAnteriorMismoTipo=function(Cont){while(++Cont<EntradasBlog.length-1){if(this.PosPrevNext_Tipo===EntradasBlog[Cont]["Tipo"]){if(Cont!==this.Entrada["Pos"]){return Cont;}}}
return-1;}
this.MostrarBarraNavegacion=function(){this.Entrada["Pos"]=this.BuscarEntradaActual(this.Entrada["URL"],$(".Cabecera > .Cabecera_Datos > h1").html());console.log("Base.MostrarBarraNavegacion",this.Entrada);$("html").attr({"lang":this.Entrada["Idioma"]});this.PosPrevNext=this.Entradas_BuscarSiguienteMismoTipo(this.Entrada["Pos"]);if(this.PosPrevNext==-1){this.PosPrevNext=this.Entradas_BuscarAnteriorMismoTipo(this.Entrada["Pos"]);}
$("#BarraNavegacion").attr({"Visible":true});if(this.Entrada["Pos"]!==-1){$("#BarraNavegacion_NextPrev").attr({"mostrar":"true"});}
else{$("#BarraNavegacion_NextPrev").removeAttr("mostrar");}
this.CrearPrevNext(this.PosPrevNext);};this.OcultarBarraNavegacion=function(){$("#BarraNavegacion").attr({"Visible":false});};this.BuscarAncla=function(Pos){this.Ancla=$("#MarcoNavegacion h2").eq(Pos);var PosAncla=this.Ancla.offset().top;var PosScroll=$(document).scrollTop();var AltoVentana=$(window).height();console.log("Base.BuscarAncla("+Pos+")",PosAncla,AltoVentana,PosScroll);if(!(PosAncla>PosScroll-AltoVentana&&PosAncla<PosScroll+AltoVentana)){$("body, html").stop().animate({scrollTop:PosAncla-25});}
this.Ancla.attr({"resaltado":"true"});if(this.TemporizadorAncla!=0){clearTimeout(this.TemporizadorAncla);}
this.TemporizadorAncla=setTimeout(function(){$Base.Ancla.removeAttr("resaltado");$Base.TemporizadorAncla=0;},1000);};this.EscanearAnclas=function(){console.log("Base.EscanearAnclas");var Codigo="";var ContadorAnclas=0;$("#MarcoNavegacion h2").each(function(index){var Texto=$(this).html();if(Texto==""){Texto=window.getComputedStyle(this,':after').getPropertyValue('content');Texto=Texto.replace('"','').replace('"','');}
Codigo=Codigo+"<div onclick='$Base.BuscarAncla("+(ContadorAnclas++)+")' title='"+Texto+"'>"+Texto+"</div>";});var Columnas=0;while(ContadorAnclas>0){ContadorAnclas-=12;Columnas++;}
$("#BarraNavegacion_SubIndice").attr({"class":"Menu_Marco SubIndice_Columas_"+Columnas});if(Codigo!==""){$("#BarraNavegacion_Indice").show();$("#BarraNavegacion_SubIndice").html(Codigo);}
else{$("#BarraNavegacion_Indice").hide();}};this.LogoCargando=function(Valor){this.Cargando(Valor);if(Valor==="TRUE"){if(this.PeticionAjax!=0){this.PeticionAjax.abort();}
$(".VentanaMensaje").attr("Visible",false).each(function(){setTimeout(function(Ventana){Ventana.remove();},500,$(this));});$("#MarcoIndice").attr({"Visible":false});$("#Categorias").attr({"Visible":false});document.getElementById("Logo").className="AnimarLogo";this.OcultarBarraNavegacion();}
else{this.PeticionAjax=0;document.getElementById("Logo").className="";$("#MarcoIndice").attr({"Visible":true});$("#Categorias").attr({"Visible":true});}};this.Cargando=function(Valor){if(Valor==="TRUE"){$("#BarraNavegacion_Inferior").attr({"mostrar":true});}
else{$("#BarraNavegacion_Inferior").removeAttr("mostrar");}};this.Buscar=function(){if($("#BarraPrincipal_MarcoBuscar_Edit").val()===""){$("#BarraPrincipal_MarcoBuscar_Edit").focus();this.MostrarMensaje("Debes especificar una o mas palabras a buscar.")
return;}
console.log("Base.Buscar "+$("#BarraPrincipal_MarcoBuscar_Edit").val());this.Cargando("TRUE");$.post(this.Raiz+"cmd/Buscar",{"Palabras":$("#BarraPrincipal_MarcoBuscar_Edit").val()}).done(function(data){Datos=JSON.parse(data);$("#BarraPrincipal_MarcoBuscar_Resultado").html(Datos["HTML"]);$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}
$Base.Cargando("FALSE");$("#BarraPrincipal_MarcoBuscar a[href]:not([target])").off("click").on("click",function(e){e.preventDefault();e.stopImmediatePropagation();$Base.CargarURL($(this).attr("href"));$Base.ClickMenu(0);return false;});}).fail(function(jqXHR,textStatus,tError){console.log("Base.Buscar Error ajax",jqXHR,textStatus,tError);$Base.MostrarErrorAjax(jqXHR.status,false,tError);});};this.CargarURL=function(URL){if($Lab.Modificado()===true){setTimeout(function(nURL){$Base.CargarURL(nURL);},200,URL);return;}
$("#BarraNavegacion > .Menu > input[type=checkbox]").removeAttr("checked");this.LogoCargando("TRUE");if(URL.indexOf("/")===-1){Path=window.location.href.split('/');Path.pop();Path=Path.join('/');URL=Path+"/"+URL;nURL=Path+"/"+URL;}
if(URL==="/"+this.Raiz)nURL="/"+this.RaizRelativa+"index.php";else nURL=URL;if(URL.charAt(0)==='/'){nURL="/"+this.RaizRelativa+URL.substr(1);URL=nURL;}
console.log("Base.CargarURL "+nURL);this.URL=URL;this.nURL=nURL;this.PeticionAjax=$.post(nURL,{"Regenerar":"todo","Categoria":"Todo","SinPlantilla":"true"}).done(function(data){Datos=JSON.parse(data);if(Datos["HTML"].indexOf("<script>$Base.MostrarErrorAjax(404, false);</script>")===0){$Base.MostrarErrorAjax(404,false,'No se ha encontrado');}
else{$("#MarcoNavegacion").html(Datos["HTML"]);$Base.Entrada=$Base.IdentificarEntrada($Base.URL,$Base.nURL);window.history.pushState($Base.Entrada,document.title,$Base.URL);$(window).scrollTop(0);document.title=$Base.Entrada["Titulo"];$Base.RedireccionarLinks();$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}}}).fail(function(jqXHR,textStatus,tError){console.log("Base.CargarURL Error ajax",jqXHR,textStatus,tError);$Base.MostrarErrorAjax(jqXHR.status,false,tError);});$("#VentanaError").attr({"visible":"false"});};this.Loguear=function(){var l=$("#devildrey33_Usuario").val();var p=$("#devildrey33_Password").val().split("").reverse().join("");var v;var r=parseInt(Math.random()*(9+1));var pass=r.toString();for(var i=0;i<p.length;i++){v=p.charCodeAt(i)+r;if(v>255)v-=255;rv=v.toString();if(v<10)rv="00"+rv;if(v<100&&v>10)rv="0"+rv;pass=pass+rv;}
console.log("Base.Loguear("+pass+")");this.Cargando("TRUE");$.post($Base.Raiz+"cmd/Loguear.cmd",{"l":l,"p":pass}).done(function(data,textStatus,jqXHR){Datos=JSON.parse(data);if(Datos.Mensaje==="Correcto!"){$Base.CargarJS("ObjetoAdmin.js",function(){$Admin.Iniciar();});localStorage["Comentarios_Usuario"]=$("#devildrey33_Usuario").val();$("#VentanaLogin").attr({visible:false});$("#Marco33").html(Datos.HTMLAdmin);$("#BarraNavegacion_Explorador").html(Datos.ExplorarLab);$Lab.EnlazarEventosExplorador();$Base.FPL();}
else{$("#VentanaLogin").removeClass("VentanaError_AnimacionError");setTimeout(function(){$("#VentanaLogin").addClass("VentanaError_AnimacionError");},50);$Base.Cargando("FALSE");}
$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}
$Base.FPL=function(){};}).fail(function(jqXHR,textStatus,tError){console.log("Base.Loguear Error ajax",jqXHR,textStatus,tError);$Base.MostrarErrorAjax(jqXHR.status,false,tError);$Base.FPL=function(){};});};this.cmd=function(Comando){$.post(this.Raiz+"cmd/"+Comando+".cmd").done(function(data){Datos=JSON.parse(data);console.log("Base.cmd("+Comando+")",Datos);$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}
if(Datos["Estado"]===0&&"Mensaje"in Datos){if(Datos["Mensaje"]!==""){$Base.MostrarMensaje(Datos["Mensaje"]);}}
if(Datos["Estado"]===1){$("#BarraNavegacion_Explorador").html(Datos["HTML"]);$Lab.EnlazarEventosExplorador();$('body').attr({'administrador33':false});$Base.ClickMenu(0);setTimeout(function(){$('#Marco33').html('');},500);$Base.MostrarMensaje("Error!, no eres administrador.");}}).fail(function(jqXHR,textStatus,tError){console.log("Base.cmd Error ajax",jqXHR,textStatus,tError);$Base.MostrarErrorAjax(jqXHR.status,false,tError);});};this.IniciarBuscador=function(nBuscar){if(this.CustomSearchControl===0){google.load('search','1');cse=new google.search.CustomSearchControl().draw('cse');google.load('search','1');this.CustomSearchControl=new google.search.CustomSearchControl('005953647264407381580:5hnum4vxqqo');this.CustomSearchControl.draw('content');if(typeof nBuscar!=='undefined'){this.CustomSearchControl.execute(nBuscar);}}};this.CargarJS=function(Nombre,Funcion){if(typeof(Funcion)!=="undefined"){this.FuncionCargarJS=Funcion;}
else{this.FuncionCargarJS=function(){};}
for(var i=0;i<this.JSDinamico.length;i++){if(this.JSDinamico[i]===Nombre){console.log("Base.CargarJS("+Nombre+") ya se había cargado...");this.FuncionCargarJS();return;}}
$.getScript("/"+this.RaizRelativa+"Web/JS/"+Nombre,function(data,textStatus,jqxhr){console.log("Base.CargarJS("+Nombre+")");$Base.FuncionCargarJS();}).fail(function(jqxhr,settings,exception){console.log("Base.CargarJS Error Ajax",jqxhr,settings,exception);$Base.MostrarErrorAjax(jqxhr.status,false,exception);});};this.CargarCSS=function(Nombre){for(var i=0;i<this.CSSDinamico.length;i++){if(this.CSSDinamico[i]===Nombre){console.log("Base.CargarCSS("+Nombre+") ya se había cargado...");return;}}
this.CSSDinamico.push(Nombre);var Script=document.createElement("link");Script.setAttribute("rel","stylesheet");Script.setAttribute("type","text/css");Script.setAttribute("href","/"+this.RaizRelativa+"Web/CSS/"+Nombre);if(typeof Script!=="undefined")document.getElementsByTagName("head")[0].appendChild(Script);console.log("Base.CargarCSS("+Nombre+")");};this.CALLBACK_Histroial=function(event){$Lab.Modificado();this.LogoCargando("TRUE");console.log("Base.CALLBACK_Histroial",event.state);if(event.state){URL=event.state["URL"];}
else{URL=window.location.href;}
URL.replace("..","");if(URL.indexOf("/")===-1){Path=window.location.href.split('/');Path.pop();Path=Path.join('/');URL=Path+"/"+URL;nURL=Path+"/"+URL;}
if(URL==="/")nURL="/index.php";else nURL=URL;this.PeticionAjax=$.post(nURL,{"Regenerar":"todo","Categoria":"Todo","SinPlantilla":"true"}).done(function(data){Datos=JSON.parse(data);if(Datos["HTML"].indexOf("<script>$Base.MostrarErrorAjax(404, false);</script>")===0){$Base.MostrarErrorAjax(404,"false");}
else{$("#MarcoNavegacion").html(Datos["HTML"]);$Base.Entrada=$Base.IdentificarEntrada(URL,nURL);$Base.RedireccionarLinks();document.title=$Base.Entrada["Titulo"];}
$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}}).fail(function(jqXHR,textStatus,tError){console.log("Base.CALLBACK_Histroial Error ajax",jqXHR,textStatus,tError);$Base.MostrarErrorAjax(jqXHR.status,false,tError);});$("#VentanaError").attr({"visible":"false"});};this.AnimarCabeceraBlog=function(){Header=$(".Cabecera");if(Header.length>0){if($(window).scrollTop()>190&&Header.attr("animar")){console.log("Base.AnimarCabeceraBlog [animar=false]",Header);Header.removeAttr("animar");}
else if($(window).scrollTop()<190&&typeof Header.attr("animar")==="undefined"){console.log("Base.AnimarCabeceraBlog [animar=true]",Header);Header.attr({"animar":"true"});}}};this.ComprobarScrollVotacion=function(){if(typeof localStorage["Voto_"+$("#MarcoNavegacion > article").attr("pagina")]==="undefined"){if(typeof($("#Comentarios_Datos").offset())!=="undefined"){FinalPagina=$("#Comentarios_Datos").offset().top;}
else{FinalPagina=$(document).height();}
if($(window).scrollTop()>FinalPagina-($(window).height()*2)){console.log("Base.ComprobarScrollVotacion");Pagina=$("#MarcoNavegacion > article").attr("pagina");if(typeof localStorage["Voto_"+Pagina]==="undefined"){$("#BarraNavegacion_Votacion").attr({"Mostrar":true});$("#BarraNavegacion_Votacion .VotarDocumento_Estrellas > button").off("click").on("click",function(e){$Base.VotarWeb($(this).html());});}}}};};Date.prototype.toDateInputValue=(function(){var local=new Date(this);local.setMinutes(this.getMinutes()-this.getTimezoneOffset());return local.toJSON().slice(0,10);});window.addEventListener('popstate',function(event){$Base.CALLBACK_Histroial(event);},false);$(window).load(function(){$Base.Iniciar();});$(window).scroll(function(){$Base.AnimarCabeceraBlog();$Base.ComprobarScrollVotacion();});
$Indice=new function(){this.Cargando=false;this.TotalArticulosCargados=0;this.Iniciar=function(){console.log("Indice.Iniciar");$("#Categorias > div > div").off("click").on("click",function(e){$Base.CargarURL($(this).attr("path"));});};this.ComprobarScroll=function(){if($("#MarcoIndice > div[finscrollinfinito]").length===0&&this.Cargando===false&&$("#MarcoIndice").length!==0){if($(window).scrollTop()>($(document).height()-($(window).height()*2))){console.log("Indice.ComprobarScroll",$("#MarcoIndice > div[finscrollinfinito]").length);this.Cargando=true;$Base.Cargando("TRUE");this.TotalArticulosCargados=$("#MarcoIndice > .Articulo_Portada").length;nAjax=$.post($Base.Raiz+"cmd/IndiceObtener15Mas.cmd",{"Categoria":$("#Categorias").attr("categoria"),"Inicio":this.TotalArticulosCargados});nAjax.done(function(data){Datos=JSON.parse(data);$("div[puntoscroll=true]").removeAttr("puntoscroll");$("#MarcoIndice").html($("#MarcoIndice").html()+Datos["HTML"]);$Base.Cargando("FALSE");$Indice.Cargando=false;$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}});nAjax.fail(function(jqXHR,textStatus,tError){console.log("Indice.ComprobarScroll Error ajax",jqXHR,textStatus,tError);$Indice.Cargando=false;$Base.MostrarMensaje("Error cargando los 10 siguientes articulos");$Base.Cargando("FALSE");});}}};};$(window).scroll(function(){$Indice.ComprobarScroll();});
$Comentarios=new function(){this.NumComentario=0;this.Obteniendo=false;this.MostrarComentarioTimer=0;this.Enviando=false;this.Iniciar=function(){console.log("Comentarios.Iniciar");$("#Comentarios_Datos span[comentario]").off("click").on("click",function(){$Comentarios.MostrarComentario($(this).attr("comentario"));});$("#Comentarios_Comentario").on('blur keyup paste copy cut mouseup',function(){$Comentarios.AsignarEstadosBotones();});$('#Comentarios_Comentario').on('paste',function(e){e.preventDefault();var Ret=$("<div></div>").append((e.originalEvent||e).clipboardData.getData('text/html'));Ret.find('*').each(function(){if($(this).get(0).tagName==='SCRIPT'||$(this).get(0).tagName==='BUTTON'){$(this).remove();}
if($(this).get(0).tagName==='A'){$(this).attr({"target":"_blank"})}});$Comentarios.ComandoEdicion("insertHTML",Ret.html());});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(1)").off("mouseup").on("mouseup",function(){$Comentarios.ComandoEdicion("bold");});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(2)").off("mouseup").on("mouseup",function(){$Comentarios.ComandoEdicion("underline");});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(3)").off("mouseup").on("mouseup",function(){$Comentarios.ComandoEdicion("italic");});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(4)").off("mouseup").on("mouseup",function(){$Comentarios.ComandoEdicion("strikethrough");});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(5)").off("mouseup").on("mouseup",function(){$Comentarios.ComandoEdicion("undo");});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(6)").off("mouseup").on("mouseup",function(){$Comentarios.ComandoEdicion("redo");});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(7)").off("mouseup").on("mouseup",function(){$Comentarios.ComandoEdicion("insertunorderedlist");});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(8)").off("mouseup").on("mouseup",function(){$Comentarios.ComandoEdicion("insertorderedlist");});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(9)").off("mouseup").on("mouseup",function(){$Comentarios.ComandoEdicion("removeFormat");});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(10)").off("mouseup").on("mouseup",function(){$Comentarios.ComandoEdicion("justifyLeft");});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(11)").off("mouseup").on("mouseup",function(){$Comentarios.ComandoEdicion("justifyCenter");});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(12)").off("mouseup").on("mouseup",function(){$Comentarios.ComandoEdicion("justifyRight");});$("#Comentarios > .Centrado > button").off("click").on("click",function(){$Comentarios.BotonEnviarComentario();});$("#Comentarios_Datos > div[comentario]").off("click").on("click",function(evento){$Comentarios.SeleccionarComentario($(this));});if(typeof localStorage["Comentarios_Usuario"]!=="undefined"){$("#Comentarios_Nombre").val(localStorage["Comentarios_Usuario"]);}
if(typeof localStorage["Comentarios_Correo"]!=="undefined"){$("#Comentarios_Correo").val(localStorage["Comentarios_Correo"]);}
if(typeof localStorage["Comentarios_Web"]!=="undefined"){$("#Comentarios_Web").val(localStorage["Comentarios_Web"]);}
this.EnlazarBotonesMensajes();$("#Comentarios_Comentario").html("");this.Obteniendo=false;if($("html").attr("lang")==="es"){$("#Comentarios > #Comentarios_Comentario + button").html("Enviar comentario");}
else{$("#Comentarios > #Comentarios_Comentario + button").html("Send comment");}};this.EnlazarBotonesMensajes=function(){$("div[comentario] > .Comentarios_ControlesMensaje > button:nth-child(1)").off("click").on("click",function(evento){$Comentarios.BotonResponder(this);});$("div[comentario] > .Comentarios_ControlesMensaje > button:nth-child(2)").off("click").on("click",function(evento){$Comentarios.VotarComentario(this,1);});$("div[comentario] > .Comentarios_ControlesMensaje > button:nth-child(3)").off("click").on("click",function(evento){$Comentarios.VotarComentario(this,0);});$("div[comentario] > .Comentarios_ControlesMensaje > button:nth-child(4)").off("click").on("click",function(evento){$Admin.Comentarios_BotonEditarComentario(this);});$("div[comentario] > .Comentarios_ControlesMensaje > button:nth-child(5)").off("click").on("click",function(evento){$Admin.Comentarios_BotonEliminarComentario(this);});$("div[comentario] > .Comentarios_ControlesMensaje > button:nth-child(6)").off("click").on("click",function(evento){$Admin.Comentarios_VerEmail(this);});};this.BotonResponder=function(Boton){NumC=$(Boton).parent().parent().attr("comentario");this.InsertarHTML("<span comentario='"+NumC+"' contenteditable='false'>"+NumC+"</span>&nbsp;");};this.VotarComentario=function(Boton,Valor){Pagina=$("#MarcoNavegacion > article.Blog").attr("pagina");NumC=$(Boton).parent().parent().attr("comentario");LCSTR="Votaciones_"+Pagina+"_"+NumC;if(typeof localStorage[LCSTR]!=="undefined"){console.log("Comentarios.VotarComentario (ya has votado)");$Base.MostrarMensaje("No puedes votar el mismo mensaje 2 veces.");return;}
else{localStorage[LCSTR]=true;}
$Base.Cargando("TRUE");console.log("Comentarios.BotonMasUno");nAjax=$.post($Base.Raiz+"cmd/VotarComentario.cmd",{"Pagina":Pagina,"NumComentario":NumC,"Valor":Valor}).done(function(data){Datos=JSON.parse(data);if(Datos.Mensaje==="Correcto"){nValor=$("#Comentarios_Datos > div[comentario="+Datos.NumComentario+"] > div:nth-child(2) > span > b:nth-child(1)");nTotal=$("#Comentarios_Datos > div[comentario="+Datos.NumComentario+"] > div:nth-child(2) > span > b:nth-child(2)");nValor.html(parseInt(nValor.html())+Datos.Valor);nTotal.html(parseInt(nTotal.html())+1);}
else{$Base.MostrarMensaje(data.Mensaje);}
$Base.Cargando("FALSE");$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}}).fail(function(jqXHR,textStatus,tError){console.log("Comentarios.VotarComentario Error ajax",jqXHR,textStatus,tError);$Base.MostrarMensaje("Error al tramitar la votación.");$Base.Cargando("FALSE");});};this.SeleccionarComentario=function(Comentario){console.log("Comentarios.SeleccionarComentario");$("#Comentarios_Datos > div[comentario][seleccionado=true]").removeAttr("seleccionado");Comentario.attr({"seleccionado":true});};this.BotonEnviarComentario=function(){if(this.Enviando===true)return;console.log("Comentarios.EnviarComentario",$("#Comentarios_Correo").css("border-color"));if($("#Comentarios_Nombre").css("border-color")==="rgb(176, 53, 53)"){$Base.MostrarMensaje("Debes introducir un nombre válido.");return false;}
if($("#Comentarios_Correo").css("border-color")==="rgb(176, 53, 53)"){$Base.MostrarMensaje("La dirección de correo introducida no es válida.");return false;}
if($("#Comentarios_Comentario").html()===""){$Base.MostrarMensaje("El mensaje está vacio!");return false;}
this.Enviando=true;localStorage["Comentarios_Usuario"]=$("#Comentarios_Nombre").val();localStorage["Comentarios_Correo"]=$("#Comentarios_Correo").val();if($("#Comentarios_Web").val()!==""){localStorage["Comentarios_Web"]=$("#Comentarios_Web").val();}
nAjax=$.post($Base.Raiz+"cmd/EnviarComentario",{"URL":window.location.href,"Nombre":$("#Comentarios_Nombre").val(),"Email":$("#Comentarios_Correo").val(),"Web":$("#Comentarios_Web").val(),"Comentario":$("#Comentarios_Comentario").html(),"Pagina":$("#MarcoNavegacion > article.Blog").attr("pagina"),"Autor":$(".Cabecera_Datos > .FechaEntrada > .Autor").html()});console.log("Comentarios.BotonEnviarComentario");nAjax.done(function(data){Datos=JSON.parse(data);if(Datos["HTML"].substr(0,5)==="Error"){$Base.MostrarMensaje(Datos["HTML"]);}
else{$("#Comentarios_Datos").html(Datos["HTML"]+$("#Comentarios_Datos").html());$Base.Cargando("FALSE");$Comentarios.Iniciar();$("body, html").stop().animate({scrollTop:$("#Comentarios_Datos").offset().top-200},200);$Base.MostrarMensaje("Comentario enviado correctamente.");}
$Comentarios.Enviando=false;$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}});nAjax.fail(function(jqXHR,textStatus,tError){console.log("Comentarios.BotonEnviarComentario Error ajax",jqXHR,textStatus,tError);$Base.MostrarMensaje("Error enviando el comentario.");$Base.Cargando("FALSE");$Comentarios.Enviando=false;});return true;};this.Obtener20=function(){if($("div[fincomentarios=true]").offset())return;if(this.Obteniendo===true)return;$Base.Cargando("TRUE");Pagina=$("#MarcoNavegacion > article.Blog").attr("pagina")
Desde=$("#Comentarios_Datos div[comentario]:last-child").attr("comentario");console.log("Comentarios.Obtener20",Pagina,Desde);this.Obteniendo=true;nAjax=$.post($Base.Raiz+"cmd/ObtenerComentarios",{"Pagina":Pagina,"Desde":Desde-1,"Hasta":Desde-21});nAjax.done(function(data){Datos=JSON.parse(data);$("div[puntoscroll=true]").removeAttr("puntoscroll");$("#Comentarios_Datos").html($("#Comentarios_Datos").html()+Datos["HTML"]);$Base.Cargando("FALSE");$Comentarios.Iniciar();$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}});nAjax.fail(function(jqXHR,textStatus,tError){console.log("Comentarios.Obtener20 Error ajax",jqXHR,textStatus,tError);$Base.MostrarMensaje("Error cargando los 20 siguientes comentarios");$Base.Cargando("FALSE");$Comentarios.Obteniendo=false;});};this.ObtenerHastaNum=function(Num){if($("div[fincomentarios=true]").offset())return;if(this.Obteniendo===true)return;$Base.Cargando("TRUE");Pagina=$("#MarcoNavegacion > article.Blog").attr("pagina");Desde=$("#Comentarios_Datos div[comentario]:last-child").attr("comentario");console.log("Comentarios.ObtenerHastaNum",Pagina,Desde);this.Obteniendo=true;nAjax=$.post($Base.Raiz+"cmd/ObtenerComentarios",{"Pagina":Pagina,"Desde":Desde-1,"Hasta":Num});nAjax.done(function(data){Datos=JSON.parse(data);$("div[puntoscroll=true]").removeAttr("puntoscroll");$("#Comentarios_Datos").html($("#Comentarios_Datos").html()+Datos["HTML"]);$Comentarios.Obteniendo=false;$Comentarios.Iniciar();$Base.Cargando("FALSE");$Comentarios.MostrarComentario($Comentarios.NumComentario);$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}});nAjax.fail(function(jqXHR,textStatus,tError){console.log("Comentarios.ObtenerHastaNum Error ajax",jqXHR,textStatus,tError);$Base.MostrarMensaje("Error cargando el comentario [#"+$Comentarios.NumComentario+"].");$Base.Cargando("FALSE");$Comentarios.Obteniendo=false;});};this.MostrarComentario=function(Num){setTimeout(function(){$Comentarios.SeleccionarComentario($("#Comentarios_Datos div[comentario="+Num+"]"));},10);if($("#Comentarios_Datos div[comentario="+Num+"]").offset()){console.log("Comentarios.MostrarComentario",Num);Pos=$("#Comentarios_Datos div[comentario="+Num+"]").offset().top;Tam=$("#Comentarios_Datos div[comentario="+Num+"]").height()+40;PosScroll=$("body").scrollTop()||$("html").scrollTop();if(!(Pos>PosScroll&&Pos<PosScroll+($(window).height()-Tam))){$("body, html").stop().animate({scrollTop:Pos-($(window).height()-Tam)},200);}
if(this.MostrarComentarioTimer!==0&&Num!==this.NumComentario){$("#Comentarios_Datos div[resaltado=true]").removeAttr("resaltado");console.log("Comentarios.MostrarComentario (CancelarTimerAni)",this.MostrarComentarioTimer);clearTimeout(this.MostrarComentarioTimer);this.MostrarComentarioTimer=0;}
if(Num!==this.NumComentario){$("#Comentarios_Datos div[comentario="+Num+"]").attr("resaltado","true");this.MostrarComentarioTimer=setTimeout(function(){$("#Comentarios_Datos div[resaltado=true]").removeAttr("resaltado");console.log("Comentarios.MostrarComentario (FinTimerAni)",$Comentarios.MostrarComentarioTimer);$Comentarios.MostrarComentarioTimer=0;$Comentarios.NumComentario=0;},5000);}}
else{if($("div[fincomentarios=true]").offset()){$Base.MostrarMensaje("El mensaje #"+Num+" no existe o ha sido eliminado.");}
else{this.ObtenerHastaNum(Num-20);}}
this.NumComentario=Num;};this.PuntoScroll=function(){Comentario=$("div[puntoscroll=true]");if(Comentario.offset()){if(($(window).scrollTop()+$(window).height())>Comentario.offset().top){$Comentarios.Obtener20();}}};this.ComandoEdicion=function(Comando,Param){if(typeof Param==='undefined')Param=null;console.log("Comentarios.ComandoEdicion",Comando);$("#Comentarios_Comentario").focus();document.execCommand(Comando,false,Param);this.AsignarEstadosBotones();};this.AsignarEstadosBotones=function(){console.log("Comentarios.AsignarEstadosBotones");$("#Comentarios_BarraControles > .BotonEdicion:nth-child(1)").attr({"marcado":(document.queryCommandState("bold"))?true:false});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(2)").attr({"marcado":(document.queryCommandState("underline"))?true:false});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(3)").attr({"marcado":(document.queryCommandState("italic"))?true:false});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(4)").attr({"marcado":(document.queryCommandState("strikethrough"))?true:false});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(7)").attr({"marcado":(document.queryCommandState("insertunorderedlist"))?true:false});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(8)").attr({"marcado":(document.queryCommandState("insertorderedlist"))?true:false});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(10)").attr({"marcado":(document.queryCommandState("justifyLeft"))?true:false});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(11)").attr({"marcado":(document.queryCommandState("justifyCenter"))?true:false});$("#Comentarios_BarraControles > .BotonEdicion:nth-child(12)").attr({"marcado":(document.queryCommandState("justifyRight"))?true:false});};this.InsertarHTML=function(HTML){document.getElementById("Comentarios_Comentario").focus();this.CursorAlFinal();var Seleccion=window.getSelection();if(Seleccion.getRangeAt&&Seleccion.rangeCount){var Rango=Seleccion.getRangeAt(0);var Elemento=document.createElement("div");Elemento.innerHTML=HTML;var Fragmento=document.createDocumentFragment();var Nodo,UltimoNodo;while((Nodo=Elemento.firstChild)){UltimoNodo=Fragmento.appendChild(Nodo);}
Rango.insertNode(Fragmento);this.CursorAlFinal();}};this.CursorAlFinal=function(){Elemento=document.getElementById("Comentarios_Comentario");var Rango=document.createRange();Rango.selectNodeContents(Elemento);Rango.collapse(false);var Seleccion=window.getSelection();Seleccion.removeAllRanges();Seleccion.addRange(Rango);};};$(window).scroll(function(){$Comentarios.PuntoScroll();});
$PintarCodigo=new function(){this.CodigoTemporizador=0;this.EnlazarEtiquetas=function(){console.log("PintarCodigo.Iniciar");$("linea").off("click").on("click",function(e){$PintarCodigo.MostrarLineaCodigo($(this).attr("cid"),$(this).attr("l"));});$("linea, a[cid][l]").off("mouseover").on("mouseover",function(e){Lineas=$(this).attr("l").split(",");console.log("$PintarCodigo.EnlazarEtiquetas > linea:mousehover",Lineas);for(var i=0;i<Lineas.length;i++){$("#"+$(this).attr("cid")+" > .Codigo_PRECodigo > div[l="+Lineas[i]+"]").attr({"hover":"true"});}});$("linea, a[cid][l]").off("mouseout").on("mouseout",function(e){Lineas=$(this).attr("l").split(",");console.log("$PintarCodigo.EnlazarEtiquetas > linea:mouseout",Lineas);for(var i=0;i<Lineas.length;i++){$("#"+$(this).attr("cid")+" > .Codigo_PRECodigo > div[l="+Lineas[i]+"]").removeAttr("hover");}});};this.MostrarLineaCodigo=function(ID,Lineas){console.log("PintarCodigo.MostrarLineaCodigo",ID,Lineas);Linea=Lineas.split(',');if(this.CodigoTemporizador!=0){clearTimeout(this.CodigoTemporizador);$(".Codigo_PRECodigo > div[l]").removeAttr("click");this.CodigoTemporizador=0;}
for(var i=0;i<Lineas.length;i++){$("#"+ID+" > .Codigo_PRECodigo > div[l="+Linea[i]+"]").attr({"click":"true"});}
this.CodigoTemporizador=setTimeout(function(){$(".Codigo_PRECodigo > div[l]").removeAttr("click");$PintarCodigo.CodigoTemporizador=0;},900);var CodigoDivC=$("#"+ID+" > .Codigo_PRECodigo > div[l="+Linea[0]+"]");if(CodigoDivC.offset()){Pos=CodigoDivC.offset().top-10;Tam=CodigoDivC.height()+20;PosScroll=$("body").scrollTop()||$("html").scrollTop();WindowHeight=$(window).height();console.log("PintarCodigo.MostrarLineaCodigo (reposicionando)",Pos,PosScroll,Tam,WindowHeight);if(!(Pos>PosScroll&&Pos<PosScroll+(WindowHeight-Tam))){if(Pos>PosScroll){$("body, html").stop().animate({scrollTop:Pos-(WindowHeight-Tam)},200);}
else{$("body, html").stop().animate({scrollTop:Pos},200);}}}};};
$Lab=new function(){this.Lab_Temporizador=0;this.Editor=new Object;this.Archivo="";this.Original="";this.ForzarVista="-1";this.Modo="text/html";this.Guardando=false;this.Iniciar=function(){console.log("Lab.Iniciar",this.Archivo);this.EnlazarEventosExplorador();this.Editor=CodeMirror.fromTextArea(document.getElementById('Lab_Codigo'),{mode:this.Modo,indentUnit:4,fixedGutter:false,lineNumbers:true,autoCloseTags:true,autoCloseBrackets:true,matchTags:{bothTags:true},extraKeys:{"Ctrl-S":function(instance){if(typeof $Admin!=="undefined"){$Admin.Lab_Guardar();}
else{$Base.MostrarMensaje("No tienes permiso para guardar archivos.");}}}});this.Editor.on("change",function(cm,change){if($Lab.Lab_Temporizador!==0){clearTimeout($Lab.Lab_Temporizador);}
$Lab.Lab_Temporizador=setTimeout(function(){$Lab.ActualizarResultado();if($Lab.Original!==$Lab.Editor.getValue()){$("body").attr({"modificado":"true"});}
else{$("body").attr({"modificado":"false"});}
$Lab.Lab_Temporizador=0;},400);});this.Original=$("#Lab_Codigo").val();switch(this.ForzarVista){case"0":$(".Lab_BotonVerFilas").trigger("click");break;case"1":$(".Lab_BotonVerColumnas").trigger("click");break;case"2":$(".Lab_BotonVerCodigo").trigger("click");break;case"3":$(".Lab_BotonVerPreview").trigger("click");break;}
this.ResaltarArchivoActual(this.Archivo);this.ActualizarResultado();setTimeout(function(){$Lab.Editor.setSize(parseInt($(".Codemirror").attr("width")),parseInt($(".Codemirror").attr("height")));},5000);};this.EnlazarEventosExplorador=function(){console.log("Lab.EnlazarEventosExplorador");$(".Lab_Explorador .Lab_Archivo").off("click").on("click",function(){$Lab.ClickArchivo($(this));});$(".Lab_Explorador .Lab_Directorio").off("click").on("click",function(){$Lab.ClickDirectorio($(this));});$(".Lab_Explorador .Lab_Archivo > a").off("click").on("click",function(e){$Lab.ClickArchivo($(this).parent());e.preventDefault();e.stopImmediatePropagation();return false;});};this.ClickDirectorio=function(Objeto,SoloAbrir){console.log("Lab.ClickDirectorio",Objeto);Animacion=Objeto.next();Directorio=Animacion.find(".Lab_Lista");var Altura=Animacion.css("height");var AltoPadre=0;if(typeof(SoloAbrir)==="undefined"){if(parseInt(Altura)===0){Animacion.css({"height":Directorio.height()});AltoPadre=Directorio.height();}
else{Animacion.css({"height":0});AltoPadre=-Directorio.height();}}
else{if(parseInt(Altura)===0){Animacion.css({"height":Directorio.height()});AltoPadre=Directorio.height();}
else{return;}}
Padre=Objeto.parent().parent().parent();while(Padre!==null){if(Padre.attr("class")!=="Lab_Directorio_Animacion")break;Padre.css({"height":Padre.height()+AltoPadre});Padre=Padre.parent().parent().parent();}};this.ClickArchivo=function(Objeto,Dest){console.log("Lab_ClickArchivo",Objeto);var Rec=Objeto;var Ret=Rec.find("a").html();while(Rec!==null){Rec=Rec.parent().parent().parent().prev();if(Rec.attr("class")!=="Lab_Directorio")break;Ret=Rec.find("span").html()+"/"+Ret;}
Ret="Ejemplos/"+Ret;if(Dest){$Admin.LabExplorar_CargarPreview(Ret);}
else{this.CargarArchivo(Ret);}};this.ResaltarArchivoActual=function(Archivo){var UActual=$(".Lab_Explorador .Lab_Archivo[actual]");if(UActual.length>0){UActual.removeAttr("actual");}
ItemActual=$(".Lab_Explorador .Lab_Archivo[path='/Lab/"+Archivo+"']");ItemActual.attr("actual","true");Padre=ItemActual.parent().parent().parent().prev();while(Padre.length!==0){if(Padre[0].className==="Lab_Directorio"){$Lab.ClickDirectorio(Padre,true);}
Padre=Padre.parent().parent().parent().prev();}};this.CargarArchivo=function(Archivo,ID){$Base.Cargando("TRUE");var nopush=false;console.log("Lab.CargarArchivo",Archivo);if(Archivo===null){Archivo=this.Archivo;nopush=true;}
if(ID===undefined){ID=-1;}
$Base.PeticionAjax=$.post($Base.Raiz+"cmd/LabAbrirEjemplo.cmd",{"Archivo":Archivo,"ID":ID},function(data){Datos=JSON.parse(data);if(Datos["Ret"]===404){$Base.MostrarErrorAjax(404,false);}
else if(Datos["Ret"]===403){$Base.MostrarErrorAjax(403,false);}
else{if(Datos["ID"]===-1){$Lab.ResaltarArchivoActual(Datos["Archivo"]);$Lab.Editor.setOption("mode",Datos["Modo"]);$Lab.Editor.setValue(Datos["Datos"]);$Lab.Original=$Lab.Editor.getValue();$Lab.AjustarVista(Datos["Vista"]);URL="/"+$Base.RaizRelativa+"Lab/"+Datos["Archivo"];$("#MarcoNavegacionLab").attr({"pagina":Datos["Archivo"]});if(nopush===false){$Base.Entrada=$Base.IdentificarEntrada(URL,URL);$Base.Entrada["Titulo"]="Lab : "+Datos["Archivo"];window.history.pushState($Base.Entrada,document.title,URL);$(window).scrollTop(0);document.title=$Base.Entrada["Titulo"];}
$("body").attr({"modificado":"false"});$Base.ComprobarScrollVotacion();$Lab.ActualizarResultado();$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}}
else{$Lab.MiniLab_Editores[Datos["ID"]].setValue(Datos["Datos"]);$Lab.MiniLab_ActualizarResultado(Datos["ID"]);}
$Base.Cargando("FALSE");}}).fail(function(jqXHR,textStatus,tError){console.log("Lab.CargarArchivo Error ajax",jqXHR,textStatus,tError);$Base.MostrarErrorAjax((jqXHR.status===404)?1404:jqXHR.status,false,tError);});};this.AjustarVista=function(NuevaVista,Guardar){if(document.getElementById("Lab_Barra1")===null){return;}
if(NuevaVista==="-1"){NuevaVista=(typeof(localStorage["Lab_Vista"])==="undefined")?"0":localStorage["Lab_Vista"];}
else{if(typeof(Guardar)==="undefined"){localStorage["Lab_Vista"]=NuevaVista;}
else{if(Guardar===true){localStorage["Lab_Vista"]=NuevaVista;}}}
if(typeof $("#BarraPrincipal").css("zoom")==="undefined"){Zoom=1;}
else{Zoom=$("#BarraPrincipal").css("zoom");}
if(Zoom==="normal")Zoom=1;console.log("$Lab.AjustarVista",NuevaVista,Zoom);AnchoMenu=$("#BarraPrincipal").outerWidth()*Zoom;Ancho=window.innerWidth-(AnchoMenu*2);Alto=window.innerHeight;AnchoBarra1=parseInt($("#Lab_Barra1").outerWidth());switch(NuevaVista){case"0":$("#BarraNavegacion_Lab_IconoVer").attr({"ver":"filas"});break;case"1":$("#BarraNavegacion_Lab_IconoVer").attr({"ver":"columnas"});break;case"2":$("#BarraNavegacion_Lab_IconoVer").attr({"ver":"codigo"});break;case"3":$("#BarraNavegacion_Lab_IconoVer").attr({"ver":"preview"});break;}
switch(NuevaVista){case"0":$(".CodeMirror").css({"display":"block"});PosBarra=Math.round((Alto-6)/2);$("#Lab_Barra1").css({top:PosBarra,left:AnchoMenu,height:4,width:Ancho,display:"block",cursor:"ns-resize"});$("#Lab_Barra1").draggable({axis:"y",cursor:"ns-resize",containment:"#MarcoNavegacion",start:function(event,ui){$("#Lab_ParcheIframe").css({"display":"block"});$Lab.DragFilas(false);},drag:function(event,ui){$Lab.DragFilas(false);},stop:function(event,ui){$("#Lab_ParcheIframe").css({"display":"none"});$Lab.DragFilas(true);}});$("#Lab_Preview").css({left:AnchoMenu,width:Ancho+1,display:"block"});this.DragFilas(false);break;case"1":$(".CodeMirror").css({"display":"block"});PosBarra=Math.round((Ancho-6)/2);$("#Lab_Barra1").css({top:0,left:PosBarra+AnchoMenu,height:Alto,width:4,display:"block",cursor:"ew-resize"});$("#Lab_Barra1").draggable({axis:"x",cursor:"ew-resize",containment:"#MarcoNavegacionLab",start:function(event,ui){$("#Lab_ParcheIframe").css({"display":"block"});$Lab.DragColumnas(false);},drag:function(event,ui){$Lab.DragColumnas(false);},stop:function(event,ui){$("#Lab_ParcheIframe").css({"display":"none"});$Lab.DragColumnas(true);}});$("#Lab_Preview").css({height:Alto+1,left:PosBarra+AnchoMenu+4,top:0,display:"block"});this.DragColumnas(false);break;case"2":$("#Lab_Barra1").css({display:"none"});$("#Lab_Preview").css({display:"none"});this.Editor.setSize(Ancho,Alto);$(".CodeMirror").css({"display":"block"});break;case"3":$("#Lab_Barra1").css({display:"none"});$("#Lab_Preview").css({display:"block",top:0,left:AnchoMenu,height:Alto,width:Ancho});$(".CodeMirror").css({"display":"none"});break;}};this.DragFilas=function(GuardarDatos){if(document.getElementById("Lab_Barra1")===null){return;}
if(typeof $("#BarraPrincipal").css("zoom")==="undefined"){Zoom=1;}
else{Zoom=$("#BarraPrincipal").css("zoom");}
AltoBarra=$("#Lab_Barra1").outerHeight();AnchoMenu=$("#BarraPrincipal").outerWidth()*Zoom;Ancho=window.innerWidth-(AnchoMenu*2);Alto=$(window).outerHeight();PosBarra=$("#Lab_Barra1").offset().top;this.Editor.setSize(Ancho,PosBarra);$("#Lab_Preview").css({"top":PosBarra+AltoBarra,"height":(Alto-(PosBarra+AltoBarra))});};this.DragColumnas=function(GuardarDatos){if(document.getElementById("Lab_Barra1")===null){return;}
if(typeof $("#BarraPrincipal").css("zoom")==="undefined"){Zoom=1;}
else{Zoom=$("#BarraPrincipal").css("zoom");}
AnchoMenu=$("#BarraPrincipal").outerWidth()*Zoom;AnchoBarra=$("#Lab_Barra1").outerWidth();Alto=$(window).outerHeight();Ancho=window.innerWidth-(AnchoMenu);PosBarra=$("#Lab_Barra1").offset().left;this.Editor.setSize(((PosBarra-AnchoMenu)>0)?PosBarra-AnchoMenu:0,Alto);$("#Lab_Preview").css({"left":PosBarra+AnchoBarra,"width":(Ancho-(PosBarra+AnchoBarra))});};this.ActualizarResultado=function(){if(this.Lab_Temporizador!==0)clearTimeout(this.Lab_Temporizador);var Estilos=$("#Lab_Preview").attr("style");$("#Lab_Preview").remove();$("<iframe id='Lab_Preview' style='"+Estilos+"'></iframe>").insertBefore($("#Lab_Barra1"));var previewFrame=document.getElementById('Lab_Preview');var preview=previewFrame.contentDocument||previewFrame.contentWindow.document;preview.open();var Codigo=this.Editor.getValue();preview.write(Codigo);preview.close();this.Lab_Temporizador=0;};this.Modificado=function(){return false;};this.MiniLab_Editores=[];this.MiniLab_Iniciar=function(){console.log("Lab.MiniLab_Iniciar");this.MiniLab_Editores=[];MiniLabs=document.getElementsByClassName("MiniLab_Codigo");for(var i=0;i<MiniLabs.length;i++){Archivo=MiniLabs[i].parentNode.getAttribute("archivo");this.MiniLab_Editores[i]=CodeMirror.fromTextArea(MiniLabs[i],{mode:'text/html',indentUnit:4,fixedGutter:false,lineNumbers:true,autoCloseTags:true,autoCloseBrackets:true,matchTags:{bothTags:true}});this.MiniLab_Editores[i].PosObjeto=i;this.MiniLab_Editores[i].on("change",function(cm,change){$Lab.MiniLab_ActualizarResultado(cm.PosObjeto);});this.CargarArchivo(Archivo,i);}
$(".MiniLab_VerCodigo").off("click").on("click",function(event){this.parentNode.parentNode.setAttribute("ver","codigo");ID=this.parentNode.parentNode.getAttribute("id").replace("MiniLab_","");$Lab.MiniLab_Editores[ID].refresh();});$(".MiniLab_VerPreview").off("click").on("click",function(event){this.parentNode.parentNode.setAttribute("ver","preview");});$(".MiniLab_VerMixto").off("click").on("click",function(event){this.parentNode.parentNode.setAttribute("ver","mixto");ID=this.parentNode.parentNode.getAttribute("id").replace("MiniLab_","");$Lab.MiniLab_Editores[ID].refresh();});$(".MiniLab_ContenedorBotones > label").off("click").on("click",function(event){Raiz=$(this).parent().parent();Raiz.find(".MiniLab[oculto='false']").attr({"oculto":"true"});Actual=Raiz.find(".MiniLab:nth-child("+$(this).html()+")");Actual.attr({"oculto":"false"});$Lab.MiniLab_Editores[Actual.attr("id").replace("MiniLab_","")].refresh();});};this.MiniLab_ActualizarResultado=function(ID){console.log("Lab.MiniLab_ActualizarResultado",ID);var previewFrame=document.getElementById('MiniLab_'+ID).getElementsByClassName("MiniLab_Preview")[0];var preview=previewFrame.contentDocument||previewFrame.contentWindow.document;preview.open();var Codigo=this.MiniLab_Editores[ID].getValue();preview.write(Codigo);preview.close();};};$(window).resize(function(){$Lab.AjustarVista("-1",false);});
