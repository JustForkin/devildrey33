<div class='Codigo_Marco' id='ID2'><div class='Codigo_Titulo'>Archivo Captcha3_Ejemplo_Motor.php función CrearCaptcha</div><div class='Codigo_Numeracion'>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br></div><pre class='Codigo_PRECodigo'><div l=1><span class='TxtNegro'><span class='TxtGris'>// Función que genera los valores aleatorios y escribe el código HTML del captcha</span></span></div><div l=2><span class='TxtNegro'><span class='TxtAzul'>function</span> CrearCaptcha() {</span></div><div l=3><span class='TxtNegro'>    <span class='TxtGris'>// Creamos las variables necesarias dentro del $_SESSION</span></span></div><div l=4><span class='TxtNegro'>    <span class='TxtAzul'>if</span> (!<span class='TxtAzul'>isset</span>(<span class='TxtMarron'>$_SESSION</span>[<span class='TxtAmarillo'>"CaptchaID"</span>])) {</span></div><div l=5><span class='TxtNegro'>        <span class='TxtMarron'>$_SESSION</span>[<span class='TxtAmarillo'>"CaptchaID"</span>] = <span class='TxtRosa'>0</span>;</span></div><div l=6><span class='TxtNegro'>        <span class='TxtMarron'>$_SESSION</span>[<span class='TxtAmarillo'>"Captcha"</span>] = <span class='TxtAzul'>array</span>();</span></div><div l=7><span class='TxtNegro'>    }</span></div><div l=8><span class='TxtNegro'>    <span class='TxtMarron'>$CaptchaID</span> = ++<span class='TxtMarron'>$_SESSION</span>[<span class='TxtAmarillo'>"CaptchaID"</span>];</span></div><div l=9><span class='TxtNegro'>    <span class='TxtMarron'>$_SESSION</span>[<span class='TxtAmarillo'>"Captcha"</span>][<span class='TxtMarron'>$CaptchaID</span>] = <span class='TxtAzul'>array</span>();</span></div><div l=10><span class='TxtNegro'>    </span></div><div l=11><span class='TxtNegro'>    <span class='TxtGris'>// Creamos la operacion aleatoria</span></span></div><div l=12><span class='TxtNegro'>    <span class='TxtMarron'>$Valor1</span> = <span class='TxtAzul'>rand</span>(<span class='TxtRosa'>10</span>, <span class='TxtRosa'>49</span>);</span></div><div l=13><span class='TxtNegro'>    <span class='TxtMarron'>$Valor2</span> = <span class='TxtAzul'>rand</span>(<span class='TxtRosa'>10</span>, <span class='TxtRosa'>49</span>);</span></div><div l=14><span class='TxtNegro'>    <span class='TxtMarron'>$Resultado</span> = <span class='TxtMarron'>$Valor1</span> + <span class='TxtMarron'>$Valor2</span>;</span></div><div l=15><span class='TxtNegro'>                </span></div><div l=16><span class='TxtNegro'>    <span class='TxtGris'>// Creamos 8 valores aleatorios</span></span></div><div l=17><span class='TxtNegro'>    <span class='TxtMarron'>$Valores</span> = <span class='TxtAzul'>array</span>();</span></div><div l=18><span class='TxtNegro'>    <span class='TxtAzul'>for</span> (<span class='TxtMarron'>$i</span> = <span class='TxtRosa'>0</span>; <span class='TxtMarron'>$i</span> &lt; <span class='TxtRosa'>8</span>; <span class='TxtMarron'>$i</span>++)     {</span></div><div l=19><span class='TxtNegro'>        do {</span></div><div l=20><span class='TxtNegro'>            <span class='TxtMarron'>$Valores</span>[<span class='TxtMarron'>$i</span>] = <span class='TxtAzul'>rand</span>(<span class='TxtRosa'>10</span>, <span class='TxtRosa'>99</span>);    </span></div><div l=21><span class='TxtNegro'>        } <span class='TxtAzul'>while</span> (<span class='TxtMarron'>$Valores</span>[<span class='TxtMarron'>$i</span>] == <span class='TxtMarron'>$Resultado</span>);</span></div><div l=22><span class='TxtNegro'>    }</span></div><div l=23><span class='TxtNegro'>    <span class='TxtGris'>// Asignamos el resultado en la posición 8</span></span></div><div l=24><span class='TxtNegro'>    <span class='TxtMarron'>$Valores</span>[<span class='TxtRosa'>8</span>] = <span class='TxtMarron'>$Resultado</span>;</span></div><div l=25><span class='TxtNegro'>    </span></div><div l=26><span class='TxtNegro'>    <span class='TxtGris'>// Mezclamos los valores aleatorios y el resultado</span></span></div><div l=27><span class='TxtNegro'>    <span class='TxtAzul'>shuffle</span>(<span class='TxtMarron'>$Valores</span>);</span></div><div l=28><span class='TxtNegro'>    </span></div><div l=29><span class='TxtNegro'>    <span class='TxtGris'>// Guardamos los valores en la variable $_SESSION</span></span></div><div l=30><span class='TxtNegro'>    <span class='TxtAzul'>for</span> (<span class='TxtMarron'>$i</span> = <span class='TxtRosa'>0</span>; <span class='TxtMarron'>$i</span> &lt; <span class='TxtRosa'>9</span>; <span class='TxtMarron'>$i</span>++) {</span></div><div l=31><span class='TxtNegro'>        <span class='TxtMarron'>$_SESSION</span>[<span class='TxtAmarillo'>"Captcha"</span>][<span class='TxtMarron'>$CaptchaID</span>][<span class='TxtMarron'>$i</span>] = <span class='TxtMarron'>$Valores</span>[<span class='TxtMarron'>$i</span>];</span></div><div l=32><span class='TxtNegro'>        <span class='TxtGris'>// Si el valor actual es el resultado guardamos su posición</span></span></div><div l=33><span class='TxtNegro'>        <span class='TxtAzul'>if</span> (<span class='TxtMarron'>$Valores</span>[<span class='TxtMarron'>$i</span>] == <span class='TxtMarron'>$Resultado</span>) <span class='TxtMarron'>$_SESSION</span>[<span class='TxtAmarillo'>"Captcha"</span>][<span class='TxtMarron'>$CaptchaID</span>][<span class='TxtAmarillo'>"Resultado"</span>] = <span class='TxtMarron'>$i</span>;</span></div><div l=34><span class='TxtNegro'>        <span class='TxtAzul'>echo</span> <span class='TxtAmarillo'>"&lt;div class='ImagenCaptcha' id='ImagenCaptcha_"</span>.<span class='TxtMarron'>$CaptchaID</span>.<span class='TxtAmarillo'>"_"</span>.<span class='TxtMarron'>$i</span>.<span class='TxtAmarillo'>"'&gt;"</span>;</span></div><div l=35><span class='TxtNegro'>        <span class='TxtAzul'>echo</span> <span class='TxtAmarillo'>"&lt;img src='Captcha3_Ejemplo_Motor.php?CaptchaID="</span>.<span class='TxtMarron'>$CaptchaID</span>.<span class='TxtAmarillo'>"&Img="</span>.<span class='TxtMarron'>$i</span>.<span class='TxtAmarillo'>"' alt='ImagenCaptcha' /&gt;"</span>;</span></div><div l=36><span class='TxtNegro'>        <span class='TxtAzul'>echo</span> <span class='TxtAmarillo'>"&lt;/div&gt;\n"</span>;</span></div><div l=37><span class='TxtNegro'>    }</span></div><div l=38><span class='TxtNegro'>    <span class='TxtAzul'>echo</span> <span class='TxtAmarillo'>"&lt;br /&gt; &lt;br /&gt;"</span>;</span></div><div l=39><span class='TxtNegro'>    <span class='TxtAzul'>echo</span> <span class='TxtAmarillo'>"&lt;div&gt;"</span>.<span class='TxtMarron'>$Valor1</span>.<span class='TxtAmarillo'>" + "</span>.<span class='TxtMarron'>$Valor2</span>.<span class='TxtAmarillo'>" = "</span>.<span class='TxtAmarillo'>"&lt;span id='ResultadoCaptcha'&gt;???&lt;/span&gt;&lt;span id='TxtResultado'&gt;&lt;/span&gt;&lt;/div&gt;"</span>;    </span></div><div l=40><span class='TxtNegro'>}</span></div></pre></div>